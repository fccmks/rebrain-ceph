## Заменить сбойный диск

_Вам дан кластер ceph, состоящий из 3 машин, и резервная машина (4 по порядку). На 3 машине был поврежден диск, используемый кластером для хранения. Необходимо настроить резервную машину, добавить ее в кластер и подключить диск._

IP-адреса тестовых машин:
- ceph1 - 10.129.0.10
- ceph2 - 10.129.0.20
- ceph3 - 10.129.0.30 - тут произошел сбой
- ceph4 - 10.129.0.40

## Для решения задачи необходимо сделать следующее

### Проверяем состояние кластера
```bash
ceph -s
```

### Подготовьте резервную машину ко вводу в кластер
```bash
yum install ceph-common
```
### Добавьте ssh от кластера ceph на машину
```bash
ssh-copy-id -f -i /etc/ceph/ceph.pub root@ceph4
```

### Дополните файл /etc/hosts на ceph4 и ceph1, чтобы машины могли обращаться друг к другу по имени хоста
```bash
[root@ceph1 ~] echo '10.129.0.40 ceph4.local ceph4' >> /etc/hosts
[root@ceph4 ~] echo '10.129.0.10 ceph1.local ceph1' >> /etc/hosts
```
### Добавьте диск с ceph4 в кластер
```bash
ceph orch host add ceph4 10.129.0.40
ceph orch daemon add osd ceph4:/dev/vdb
ceph orch ps
# мониторим состояние с помощью
ceph -s
```

### Удалите сбойный диск
```bash
# Определите его имя
ceph orch ps
# Удалите запись из crushmap
ceph osd crush remove osd.2
# Удалите диск
ceph osd rm osd.2
# Удалите daemon, отвечающий за сбойный диск (--force нужен, потому что на сбойном диске есть данные, которые ceph считает нужными и просто так не удаляет)
ceph orch daemon rm osd.2 --force
```
